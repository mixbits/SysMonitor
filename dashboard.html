<!DOCTYPE html>
<html style="height: 100%; overflow: hidden;">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>System Monitor - Dashboard</title>
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon" href="/images/sysmonitor.ico">
        <link rel="icon" href="/images/sysmonitor.ico?v=2" type="image/x-icon">
        <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
        <script>
            let isMobileDevice = false;
            let isTabletDevice = false;
            let deviceOrientation = 'landscape';
            
            function detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const width = window.innerWidth;
                const height = window.innerHeight;
                
                isMobileDevice = /android|webos|iphone|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
                
                isTabletDevice = /ipad|tablet|playbook|silk/i.test(userAgent) || 
                                 (width >= 768 && width <= 1024);
                
                deviceOrientation = width > height ? 'landscape' : 'portrait';
                
                document.body.classList.remove('desktop-device', 'mobile-device', 'tablet-device', 'landscape-orientation', 'portrait-orientation');
                
                if (isMobileDevice) {
                    document.body.classList.add('mobile-device');
                } else if (isTabletDevice) {
                    document.body.classList.add('tablet-device');
                } else {
                    document.body.classList.add('desktop-device');
                }
                
                document.body.classList.add(deviceOrientation + '-orientation');
                
                console.log(`Device detected: ${isMobileDevice ? 'Mobile' : isTabletDevice ? 'Tablet' : 'Desktop'}, Orientation: ${deviceOrientation}`);
            }
            
            window.addEventListener('resize', function() {
                detectDevice();
                applyDeviceSpecificGraphAdjustments();
            });
            
            window.addEventListener('DOMContentLoaded', function() {
                detectDevice();
                
                applyDeviceSpecificOptimizations();
                
                setTimeout(initDashboardGraphs, 100);
                
                setTimeout(window.handleDashboardLoadingSpinners, 500);
                
                createDashboardGraphs();
                
                setTimeout(removeNsewDragElements, 500);
                setTimeout(removeNsewDragElements, 1000);
                
                const styleEl = document.createElement('style');
                styleEl.textContent = `
                    .js-plotly-plot .plotbg {
                        fill: rgba(242,232,220,0.8) !important;
                    }
                    .js-plotly-plot .main-svg {
                        background-color: rgba(0,0,0,0) !important;
                    }
                    .js-plotly-plot .plot-container {
                        background-color: rgba(0,0,0,0) !important;
                    }
                    .js-plotly-plot .legend rect.bg {
                        fill: rgba(0, 0, 0, 0) !important;
                        stroke: rgba(0, 0, 0, 0) !important;
                    }
                    .js-plotly-plot .legend text {
                        fill: #5c4023 !important;
                    }
                    .js-plotly-plot .legend path.legendtoggle {
                        fill-opacity: 0 !important;
                    }
                `;
                document.head.appendChild(styleEl);
                
                window.addEventListener('orientationchange', function() {
                    setTimeout(function() {
                        detectDevice();
                        applyDeviceSpecificOptimizations();
                        applyDeviceSpecificGraphAdjustments();
                    }, 300);
                });
                
                setInterval(() => {
                    updateDashboardGraphs();
                }, 3000);
            });
            
            function getPlotlyConfig(isDesktop, isMobile, isTablet) {
                const baseConfig = {
                    displayModeBar: false,
                    staticPlot: false,
                    scrollZoom: false,
                    doubleClick: false,
                    showTips: false,
                    displaylogo: false,
                    responsive: true
                };
                
                if (isMobile) {
                    baseConfig.scrollZoom = false;
                }
                
                return baseConfig;
            }
            
            function applyDeviceSpecificGraphAdjustments() {
                const shortGraph = document.getElementById('short-graph');
                const longGraph = document.getElementById('long-graph');
                
                if (!shortGraph || !longGraph) return;
                
                if (isMobileDevice) {
                    console.log("Applying mobile-specific graph adjustments");
                    
                    if (deviceOrientation === 'portrait') {
                        adjustGraphLayout(shortGraph, {
                            height: Math.min(300, window.innerHeight * 0.4),
                            margin: { l: 35, r: 20, t: 40, b: 40 },
                            legend: {
                                orientation: 'h',
                                y: 1.1,
                                x: 0.5,
                                xanchor: 'center'
                            }
                        });
                        
                        adjustGraphLayout(longGraph, {
                            height: Math.min(300, window.innerHeight * 0.4),
                            margin: { l: 35, r: 20, t: 40, b: 40 },
                            legend: {
                                orientation: 'h',
                                y: 1.1,
                                x: 0.5,
                                xanchor: 'center'
                            }
                        });
                    } else {
                        adjustGraphLayout(shortGraph, {
                            height: Math.min(250, window.innerHeight * 0.8),
                            margin: { l: 35, r: 10, t: 40, b: 40 },
                            legend: {
                                orientation: 'h',
                                y: 1.02,
                                x: 1,
                                xanchor: 'right'
                            }
                        });
                        
                        adjustGraphLayout(longGraph, {
                            height: Math.min(250, window.innerHeight * 0.8),
                            margin: { l: 35, r: 10, t: 40, b: 40 },
                            legend: {
                                orientation: 'h',
                                y: 1.02,
                                x: 1,
                                xanchor: 'right'
                            }
                        });
                    }
                } else if (isTabletDevice) {
                    console.log("Applying tablet-specific graph adjustments");
                    
                    adjustGraphLayout(shortGraph, {
                        height: 280,
                        margin: { l: 40, r: 20, t: 40, b: 50 }
                    });
                    
                    adjustGraphLayout(longGraph, {
                        height: 280,
                        margin: { l: 40, r: 20, t: 40, b: 50 }
                    });
                } else {
                    console.log("Applying desktop graph adjustments");
                    adjustGraphLayout(shortGraph, {
                        height: 270,
                        margin: { l: 45, r: 20, t: 40, b: 60 }
                    });
                    
                    adjustGraphLayout(longGraph, {
                        height: 270,
                        margin: { l: 45, r: 20, t: 40, b: 60 }
                    });
                }
            }
            
            function adjustGraphLayout(graphElement, layoutUpdates) {
                if (graphElement && graphElement._fullLayout) {
                    Plotly.relayout(graphElement, layoutUpdates);
                }
            }

            let shortHistory = {
                time: [],
                cpu: [],
                ram: [],
                net: [],
                gpu0: [],
                gpu1: [],
                gpu2: []
            };
            
            let longHistory = {
                time: [],
                cpu: [],
                ram: [],
                net: [],
                gpu0: [],
                gpu1: [],
                gpu2: []
            };
            
            async function fetchFromAPI(endpoint) {
                try {
                    console.log(`Fetching data from ${endpoint}...`);
                    const response = await fetch(endpoint);
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                    }
                    const data = await response.json();
                    console.log(`Data received from ${endpoint}:`, data);
                    if (!data) {
                        throw new Error(`Empty data received from ${endpoint}`);
                    }
                    return data;
                } catch (error) {
                    console.error(`Error fetching from ${endpoint}:`, error);
                    return null;
                }
            }
            
            async function fetchCurrentStats() {
                const data = await fetchFromAPI('/api/current');
                if (data) {
                    return data;
                }
                return null;
            }
            
            async function fetchShortHistory() {
                console.log("Fetching short history data...");
                const data = await fetchFromAPI('/api/short-history');
                if (data) {
                    try {
                        shortHistory = {
                            time: data.time.map(t => new Date(t)),
                            cpu: data.cpu,
                            ram: data.ram,
                            net: data.net,
                            gpu0: data.gpu0,
                            gpu1: data.gpu1,
                            gpu2: data.gpu2
                        };
                        console.log("Short history data processed", shortHistory.time.length, "data points");
                        return shortHistory;
                    } catch (error) {
                        console.error("Error processing short history data:", error);
                        return {
                            time: [], cpu: [], ram: [], net: [], gpu0: [], gpu1: [], gpu2: []
                        };
                    }
                }
                console.warn("No short history data received");
                return {
                    time: [], cpu: [], ram: [], net: [], gpu0: [], gpu1: [], gpu2: []
                };
            }
            
            async function fetchLongHistory() {
                console.log("Fetching long history data...");
                
                const data = await fetchFromAPI('/api/long-history');
                
                const today = new Date().toISOString().split('T')[0];
                const todayData = await fetchFromAPI(`/api/log-data/${today}`);
                
                if (data) {
                    try {
                        longHistory = {
                            time: data.time.map(t => new Date(t)),
                            cpu: data.cpu,
                            ram: data.ram,
                            net: data.net,
                            gpu0: data.gpu0,
                            gpu1: data.gpu1,
                            gpu2: data.gpu2
                        };
                        console.log("Long history data from API processed", longHistory.time.length, "data points");
                    } catch (error) {
                        console.error("Error processing long history data from API:", error);
                        longHistory = {
                            time: [], cpu: [], ram: [], net: [], gpu0: [], gpu1: [], gpu2: []
                        };
                    }
                }
                
                if (todayData && !todayData.error) {
                    try {
                        console.log("Log data for today received, processing...");
                        
                        const logData = {
                            time: todayData.time.map(t => new Date(t)),
                            cpu: todayData.cpu,
                            ram: todayData.ram,
                            net: todayData.net,
                            gpu0: todayData.gpu0,
                            gpu1: todayData.gpu1,
                            gpu2: todayData.gpu2
                        };
                        
                        const now = new Date();
                        const threeHoursAgo = new Date(now.getTime() - (3 * 60 * 60 * 1000 + 15 * 60 * 1000));
                        
                        const filteredData = {
                            time: [],
                            cpu: [],
                            ram: [],
                            net: [],
                            gpu0: [],
                            gpu1: [],
                            gpu2: []
                        };
                        
                        let lastTimeAdded = null;
                        for (let i = 0; i < logData.time.length; i++) {
                            const time = logData.time[i];
                            
                            if (time < threeHoursAgo) continue;
                            
                            if (longHistory.time.length > 0 && time >= longHistory.time[0]) continue;
                            
                            if (lastTimeAdded === null || (time - lastTimeAdded) >= 20000) {
                                filteredData.time.push(time);
                                filteredData.cpu.push(logData.cpu[i]);
                                filteredData.ram.push(logData.ram[i]);
                                filteredData.net.push(logData.net[i]);
                                filteredData.gpu0.push(logData.gpu0[i]);
                                filteredData.gpu1.push(logData.gpu1[i]);
                                filteredData.gpu2.push(logData.gpu2[i]);
                                lastTimeAdded = time;
                            }
                        }
                        
                        console.log("Filtered log data to", filteredData.time.length, "points for 3-hour history");
                        
                        longHistory = {
                            time: [...filteredData.time, ...longHistory.time],
                            cpu: [...filteredData.cpu, ...longHistory.cpu],
                            ram: [...filteredData.ram, ...longHistory.ram],
                            net: [...filteredData.net, ...longHistory.net],
                            gpu0: [...filteredData.gpu0, ...longHistory.gpu0],
                            gpu1: [...filteredData.gpu1, ...longHistory.gpu1],
                            gpu2: [...filteredData.gpu2, ...longHistory.gpu2]
                        };
                        
                        if (longHistory.time.length > 540) {
                            const excess = longHistory.time.length - 540;
                            longHistory.time = longHistory.time.slice(excess);
                            longHistory.cpu = longHistory.cpu.slice(excess);
                            longHistory.ram = longHistory.ram.slice(excess);
                            longHistory.net = longHistory.net.slice(excess);
                            longHistory.gpu0 = longHistory.gpu0.slice(excess);
                            longHistory.gpu1 = longHistory.gpu1.slice(excess);
                            longHistory.gpu2 = longHistory.gpu2.slice(excess);
                        }
                        
                        console.log("Combined history data now has", longHistory.time.length, "data points");
                    } catch (error) {
                        console.error("Error processing log data for today:", error);
                    }
                } else {
                    console.log("No log data for today available or error occurred");
                }
                
                return longHistory;
            }
        </script>
        <style>
            * {
                -webkit-overflow-scrolling: touch;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                box-sizing: border-box;
            }
            
            @supports (-webkit-touch-callout: none) {
                body {
                    background-attachment: scroll;
                }
            }
            
            html, body {
                overscroll-behavior: none;
                font-size: 16px;
                background-color: #9d8e81;
                margin: 0 !important;
                padding: 0 !important;
                height: 100% !important; 
                width: 100% !important;
                overflow: hidden !important;
                color: #333;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-image: url('/images/leaves.jpg');
                background-position: center center;
                background-repeat: no-repeat;
                background-size: cover;
                background-attachment: fixed;
                position: relative;
            }
            
            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: radial-gradient(
                    ellipse at center,
                    rgba(0, 0, 0, 0) 0%,
                    rgba(0, 0, 0, 0) 50%,
                    rgba(0, 0, 0, 0.5) 100%
                );
                pointer-events: none;
                z-index: 0;
            }
            
            #page-content, .nav-container {
                position: relative;
                z-index: 1;
            }
            
            @media (orientation: portrait) {
                html, body {
                    background-size: auto 100%;
                }
                
                body::before {
                    background: radial-gradient(
                        ellipse at center,
                        rgba(0, 0, 0, 0) 0%,
                        rgba(0, 0, 0, 0) 40%,
                        rgba(0, 0, 0, 0.5) 100%
                    );
                }
            }
            
            @media (orientation: landscape) {
                html, body {
                    background-size: 100% auto;
                }
            }
            
            @media (min-aspect-ratio: 1/1) {
                html, body {
                    background-size: cover;
                }
            }
            
            input, select, textarea {
                font-size: 16px;
            }
            
            button, .nav-button {
                min-height: 44px;
                min-width: 44px;
            }
            
            h1, h2, h3, h4, h5, h6 {
                color: #5c4023 !important;
                margin-top: 0 !important;
            }
            
            .nav-links {
                display: flex !important;
                margin-left: auto !important;
                padding-left: 10px !important;
            }
            
            .nav-button {
                padding: 8px 16px !important;
                background-color: #8b6b4f !important;
                color: white !important;
                border: none !important;
                border-radius: 6px !important;
                cursor: pointer !important;
                font-size: 14px !important;
                font-weight: 500 !important;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2) !important;
                text-decoration: none !important;
                display: inline-block !important;
                text-align: center !important;
                min-height: 30px !important;
                transition: all 0.2s ease-in-out !important;
            }
            
            .nav-button:hover {
                background-color: #a17d5d !important;
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3) !important;
            }
            
            .nav-button:active {
                background-color: #6a5339 !important;
                box-shadow: 0 1px 4px rgba(0, 0, 0, 0.4) inset !important;
                transform: translateY(1px) !important;
            }
            
            .app-title {
                display: inline-block !important;
                font-size: 20px !important;
                color: #000000 !important;
                text-shadow: none !important;
                text-align: center !important;
                margin: 0 auto !important;
                font-weight: bold !important;
            }
            
            @media screen and (max-width: 768px) {
                .nav-container {
                    flex-direction: row !important;
                    align-items: center !important;
                    padding: 8px 15px !important;
                    height: auto !important;
                }
                
                h1, .app-title {
                    font-size: 18px !important;
                    margin: 0 auto !important;
                }
                
                .graph-container {
                    width: 100% !important;
                    height: auto !important;
                }
                
                .container {
                    padding: 5px !important;
                    margin-top: 5px !important;
                }
            }
            
            @media screen and (max-width: 480px) {
                h1, .app-title {
                    font-size: 16px !important;
                    max-width: 60% !important;
                }
                
                .nav-button {
                    width: auto !important;
                    margin-top: 0 !important;
                    padding: 4px 10px !important;
                    font-size: 12px !important;
                }
            }
            
            @media screen and (max-height: 500px) and (orientation: landscape) {
                .container {
                    min-height: auto !important;
                }
                
                .graph-container {
                    height: 180px !important;
                }
            }
            
            .container {
                width: 100% !important;
                padding: 5px 15px 2px 15px !important;
                box-sizing: border-box !important;
                background-color: transparent !important;
                border-radius: 10px !important;
                box-shadow: none !important;
                margin-top: 5px !important;
            height: calc(100vh - 55px) !important;
                overflow: hidden !important;
                position: relative !important;
            }
            
            .dashboard-container {
                display: flex !important;
                flex-direction: column !important;
                width: 100% !important;
                gap: 5px !important;
                height: calc(100vh - 70px) !important;
                justify-content: space-between !important;
                overflow: hidden !important;
                padding-bottom: 0 !important;
                margin-bottom: 0 !important;
            }
            
            .graph-wrapper {
                width: 100% !important;
                margin: 0 !important;
                background-color: #f2e8dc !important;
                border-radius: 8px !important;
                padding: 8px 15px !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
                transition: none !important;
                flex: 1 !important;
                max-height: calc(50vh - 25px) !important;
                display: flex !important;
                flex-direction: column !important;
                overflow: hidden !important;
            }
            
            .nav-container {
                width: 100% !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                background-color: #6B4423 !important;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;
                border: none !important;
                border-bottom: 4px solid #4D3018 !important;
                padding: 4px 20px !important;
                height: 45px !important;
                box-sizing: border-box !important;
                z-index: 1000 !important;
            }
            
            ._dash-loading-callback {
                border-color: rgba(0, 0, 0, 0.15) !important;
                border-top-color: black !important;
            }
            
            ._dash-loading-callback._dash-loading-dots::after,
            ._dash-loading-callback._dash-loading-dots::before,
            ._dash-loading-callback._dash-loading-dots {
                background-color: black !important;
            }
            
            .dash-spinner.dash-default-spinner {
                border-color: rgba(0, 0, 0, 0.15) !important;
                border-top-color: black !important;
            }
            
            #loading-short-graph .dash-spinner, #loading-long-graph .dash-spinner {
                position: absolute !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                z-index: 1000 !important;
                background-color: rgba(255, 255, 255, 0.5) !important;
                border-radius: 50% !important;
                padding: 20px !important;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2) !important;
            }
            
            #loading-short-graph._dash-loading, #loading-long-graph._dash-loading {
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background-color: rgba(242, 232, 220, 0.7) !important;
                z-index: 999 !important;
                border-radius: 8px !important;
            }
            
            #short-graph:not(:empty) + #loading-short-graph .dash-spinner,
            #long-graph:not(:empty) + #loading-long-graph .dash-spinner {
                display: none !important;
            }
            
            .spinner-border {
                display: inline-block;
                width: 3rem;
                height: 3rem;
                vertical-align: text-bottom;
                border: 0.3em solid black;
                border-right-color: transparent;
                border-radius: 50%;
                animation: spinner-border 0.75s linear infinite;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            }
            
            @keyframes spinner-border {
                to { transform: rotate(360deg); }
            }
            
            .graph-loading-overlay {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background-color: rgba(242, 232, 220, 0.85) !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                z-index: 1000 !important;
                border-radius: 8px !important;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            }
            
            .graph-loading-overlay.loading {
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            .graph-wrapper {
                position: relative !important;
            }
            
            .graph-loading-overlay {
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            }
            
            .graph-loading-overlay.loading {
                opacity: 1;
                visibility: visible;
            }
            
            #short-graph, #long-graph {
                cursor: default !important;
                pointer-events: none !important;
            }
            
            #short-graph-loading:not(.loading),
            #long-graph-loading:not(.loading) {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            #short-graph-loading:not(.loading) .spinner-border,
            #long-graph-loading:not(.loading) .spinner-border {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            
            .graph-loading-overlay .spinner-border {
                transition: opacity 0.3s ease;
            }
            
            .graph-loading-overlay[style*="display: none"] .spinner-border,
            .graph-loading-overlay[style*="visibility: hidden"] .spinner-border,
            .graph-loading-overlay[style*="opacity: 0"] .spinner-border {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            
            rect.nsewdrag,
            rect.drag,
            rect.nsewdrag.drag {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }

            .js-plotly-plot rect.nsewdrag,
            .js-plotly-plot rect.drag {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            
            .js-plotly-plot .legend rect.bg {
                fill: rgba(0, 0, 0, 0) !important;
                stroke: rgba(0, 0, 0, 0) !important;
            }
            
            .js-plotly-plot .legend text {
                fill: #5c4023 !important;
            }
            
            .js-plotly-plot .legend path.legendtoggle {
                fill-opacity: 0 !important;
            }
            
            .mobile-device .dashboard-container {
                padding: 5px !important;
                gap: 5px !important;
            }
            
            .mobile-device .graph-wrapper {
                padding: 5px !important;
                margin: 0 !important;
            }
            
            .mobile-device.portrait-orientation .dashboard-container {
                flex-direction: column !important;
            }
            
            .mobile-device.portrait-orientation .graph-wrapper {
                width: 100% !important;
                max-height: calc(50vh - 40px) !important;
            }
            
            .mobile-device.portrait-orientation .app-title {
                font-size: 16px !important;
                white-space: normal !important;
                line-height: 1.2 !important;
            }
            
            .mobile-device .nav-container {
                height: auto !important;
                padding: 5px 10px !important;
            }
            
            .mobile-device .nav-button {
                padding: 6px 12px !important;
                font-size: 12px !important;
                min-height: 36px !important;
            }
            
            .mobile-device .graph-container {
                touch-action: pan-x pan-y !important;
            }
            
            .mobile-device .modebar {
                transform: scale(1.2) !important;
                transform-origin: top right !important;
            }
            
            .tablet-device .dashboard-container {
                gap: 10px !important;
            }
            
            .tablet-device.portrait-orientation .dashboard-container {
                flex-direction: column !important;
            }
            
            .tablet-device.portrait-orientation .graph-wrapper {
                width: 100% !important;
                max-height: calc(50vh - 40px) !important;
            }
        </style>
    </head>
    <body>
        <div id="react-entry-point">
            <div id="app-container">
                <div class="nav-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                        <div id="nav-buttons-container" style="flex: 1;">
                            <a href="/logs" class="nav-button">Log Viewer</a>
                        </div>
                        
                        <h1 class="app-title" style="flex: 2; text-align: center; margin: 0 auto; font-weight: 900; color: #000000; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            System Monitor (host machine name)
                        </h1>
                        
                        <div style="flex: 1;"></div>
                    </div>
                </div>
                
                <div id="page-content" class="container">
                    <div id="dashboard-viewer-layout" class="log-viewer-container" style="height: calc(100vh - 70px); padding: 15px 15px 25px 15px;">
                        <div id="dashboard-graphs-container" class="graph-wrapper" style="margin-top: 0; height: calc(100vh - 120px); min-height: 600px; display: flex; flex-direction: column; position: relative; gap: 15px; padding-bottom: 10px; background-color: rgba(242, 232, 220, 0.95) !important; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4) !important;">
                            <div class="graph-wrapper" style="position: relative; flex: 0.95; min-height: 270px; margin: 0 0 5px 0; padding: 3px 3px 8px 3px; border-radius: 8px; background-color: rgba(242, 232, 220, 0.95); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
                                <div class="graph-loading-overlay loading" id="short-graph-loading" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(242, 232, 220, 0.85) !important; display: flex; justify-content: center; align-items: center; z-index: 1000; border-radius: 8px;">
                                <div class="spinner-border" style="color: black;"></div>
                            </div>
                            
                                <div id="short-graph" class="graph-container dashboard-graph" style="height: 100%; width: 100%;"></div>
                        </div>
                        
                            <div class="graph-wrapper" style="position: relative; flex: 0.95; min-height: 270px; margin: 5px 0 0 0; padding: 3px 3px 18px 3px; border-radius: 8px; background-color: rgba(242, 232, 220, 0.95); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
                                <div class="graph-loading-overlay loading" id="long-graph-loading" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(242, 232, 220, 0.85) !important; display: flex; justify-content: center; align-items: center; z-index: 1000; border-radius: 8px;">
                                <div class="spinner-border" style="color: black;"></div>
                            </div>
                            
                                <div id="long-graph" class="graph-container dashboard-graph" style="height: 100%; width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            function initDashboardGraphs() {
                console.log('Initializing dashboard graphs');
                
                const shortGraph = document.getElementById('short-graph');
                const longGraph = document.getElementById('long-graph');
                
                const shortGraphOverlay = document.getElementById('short-graph-loading');
                const longGraphOverlay = document.getElementById('long-graph-loading');
                if (shortGraphOverlay && longGraphOverlay) {
                    shortGraphOverlay.classList.add('loading');
                    longGraphOverlay.classList.add('loading');
                }
            }
            
            window.graphsInitialLoadComplete = false;
            
            window.handleDashboardLoadingSpinners = function() {
                const shortGraph = document.getElementById('short-graph');
                const longGraph = document.getElementById('long-graph');
                
                const shortGraphOverlay = document.getElementById('short-graph-loading');
                const longGraphOverlay = document.getElementById('long-graph-loading');
                
                if (!window.graphsInitialLoadComplete) {
                    if (shortGraphOverlay && longGraphOverlay) {
                        shortGraphOverlay.classList.add('loading');
                        longGraphOverlay.classList.add('loading');
                    }
                    
                    const shortGraphHasContainer = shortGraph && shortGraph.querySelector('.plot-container');
                    const longGraphHasContainer = longGraph && longGraph.querySelector('.plot-container');
                    
                    const shortGraphHasData = shortGraph && shortGraph.querySelectorAll('.trace').length > 0;
                    const longGraphHasData = longGraph && longGraph.querySelectorAll('.trace').length > 0;
                    
                    const shortGraphLoadingDone = shortGraph && !shortGraph.hasAttribute('data-dash-is-loading');
                    const longGraphLoadingDone = longGraph && !longGraph.hasAttribute('data-dash-is-loading');
                    
                    const shortGraphHasSVG = shortGraph && shortGraph.querySelector('svg.main-svg');
                    const longGraphHasSVG = longGraph && longGraph.querySelector('svg.main-svg');
                    
                    const shortGraphReady = shortGraphHasContainer && shortGraphLoadingDone;
                    const longGraphReady = longGraphHasContainer && longGraphLoadingDone;
                    
                    console.log('Graph loading check - Short ready:', shortGraphReady, 'Long ready:', longGraphReady);
                    
                    if (shortGraphReady && longGraphReady) {
                        setTimeout(() => {
                            window.graphsInitialLoadComplete = true;
                            console.log('Dashboard graphs ready, hiding spinners');
                            
                            if (shortGraphOverlay && longGraphOverlay) {
                                shortGraphOverlay.classList.remove('loading');
                                longGraphOverlay.classList.remove('loading');
                                
                                shortGraphOverlay.style.display = 'none';
                                shortGraphOverlay.style.visibility = 'hidden';
                                shortGraphOverlay.style.opacity = '0';
                                
                                longGraphOverlay.style.display = 'none';
                                longGraphOverlay.style.visibility = 'hidden';
                                longGraphOverlay.style.opacity = '0';
                                
                                const shortSpinner = shortGraphOverlay.querySelector('.spinner-border');
                                const longSpinner = longGraphOverlay.querySelector('.spinner-border');
                                if (shortSpinner) {
                                    shortSpinner.style.display = 'none';
                                    shortSpinner.style.visibility = 'hidden';
                                }
                                if (longSpinner) {
                                    longSpinner.style.display = 'none';
                                    longSpinner.style.visibility = 'hidden';
                                }
                                
                                if (shortGraph && longGraph) {
                                    const shortSvgContainer = shortGraph.querySelector('.svg-container');
                                    const longSvgContainer = longGraph.querySelector('.svg-container');
                                    
                                    if (shortSvgContainer) {
                                        shortSvgContainer.style.visibility = 'visible';
                                        shortSvgContainer.style.opacity = '1';
                                        shortSvgContainer.style.display = 'block';
                                    }
                                    
                                    if (longSvgContainer) {
                                        longSvgContainer.style.visibility = 'visible';
                                        longSvgContainer.style.opacity = '1';
                                        longSvgContainer.style.display = 'block';
                                    }
                                    
                                    const shortPlotlyContainer = shortGraph.querySelector('.js-plotly-plot');
                                    const longPlotlyContainer = longGraph.querySelector('.js-plotly-plot');
                                    
                                    if (shortPlotlyContainer) {
                                        shortPlotlyContainer.style.visibility = 'visible';
                                        shortPlotlyContainer.style.opacity = '1';
                                    }
                                    
                                    if (longPlotlyContainer) {
                                        longPlotlyContainer.style.visibility = 'visible';
                                        longPlotlyContainer.style.opacity = '1';
                                    }
                                    
                                    console.log('Made graph SVG containers visible');
                                }
                                
                                removeNsewDragElements();
                            }
                        }, 500);
                    } else {
                        setTimeout(window.handleDashboardLoadingSpinners, 250);
                    }
                }
            };
            
            function removeNsewDragElements() {
                const dragElements = document.querySelectorAll('rect.nsewdrag, rect.drag');
                if (dragElements.length > 0) {
                    console.log('Found and removing drag elements:', dragElements.length);
                    dragElements.forEach(el => {
                        el.style.display = 'none';
                        el.style.visibility = 'hidden';
                        el.style.opacity = '0';
                        el.remove();
                    });
                }
            }
            
            function createDashboardGraphs() {
                console.log('Creating dashboard graphs');
                
                createEmptyPlots();
                
                Promise.all([fetchShortHistory(), fetchLongHistory()])
                    .then(() => {
                        updateShortGraph();
                        updateLongGraph();
                        
                        setTimeout(() => {
                            const shortGraphOverlay = document.getElementById('short-graph-loading');
                            const longGraphOverlay = document.getElementById('long-graph-loading');
                            
                            if (shortGraphOverlay) {
                                shortGraphOverlay.classList.remove('loading');
                                shortGraphOverlay.style.display = 'none';
                            }
                            
                            if (longGraphOverlay) {
                                longGraphOverlay.classList.remove('loading');
                                longGraphOverlay.style.display = 'none';
                            }
                            
                            window.graphsInitialLoadComplete = true;
                        }, 1000);
                    });
            }
            
            function createEmptyPlots() {
                    const shortGraphElement = document.getElementById('short-graph');
                const longGraphElement = document.getElementById('long-graph');
                
                const emptyTraces = [
                    { x: [], y: [], mode: 'lines', name: 'CPU', line: { color: '#1f77b4', width: 2 } },
                    { x: [], y: [], mode: 'lines', name: 'RAM', line: { color: '#ff7f0e', width: 2 } },
                    { x: [], y: [], mode: 'lines', name: 'Network', line: { color: '#2ca02c', width: 2 } },
                    { x: [], y: [], mode: 'lines', name: 'GPU 0', line: { color: '#d62728', width: 2 } },
                    { x: [], y: [], mode: 'lines', name: 'GPU 1', line: { color: '#9467bd', width: 2 } },
                    { x: [], y: [], mode: 'lines', name: 'GPU 2', line: { color: '#8c564b', width: 2 } }
                ];
                
                let titleFontSize = 20;
                let axisFontSize = 16;
                let legendFontSize = 12;
                let graphHeight = 270;
                let marginLeft = 45;
                let marginBottom = 60;
                
                if (isMobileDevice) {
                    titleFontSize = 16;
                    axisFontSize = 12;
                    legendFontSize = 10;
                    marginLeft = 35;
                    marginBottom = 40;
                    
                    if (deviceOrientation === 'portrait') {
                        graphHeight = Math.min(300, window.innerHeight * 0.4);
                    } else {
                        graphHeight = Math.min(250, window.innerHeight * 0.8);
                    }
                } else if (isTabletDevice) {
                    titleFontSize = 18;
                    axisFontSize = 14;
                    graphHeight = 280;
                    marginLeft = 40;
                    marginBottom = 50;
                }
                
                const legendOrientation = isMobileDevice && deviceOrientation === 'portrait' ? 'h' : 'h';
                const legendX = isMobileDevice && deviceOrientation === 'portrait' ? 0.5 : 1;
                const legendXAnchor = isMobileDevice && deviceOrientation === 'portrait' ? 'center' : 'right';
                
                const commonLayoutBase = {
                    xaxis: {
                        title: { 
                            text: 'Time', 
                            font: { size: axisFontSize, color: '#5c4023' },
                            standoff: 0,
                            y: 0.8
                        },
                        gridcolor: '#e1d5c9',
                        showgrid: true,
                        zeroline: true,
                        showline: true,
                        linecolor: '#5c4023',
                        linewidth: 1,
                        tickformat: '%I:%M %p'
                    },
                    yaxis: {
                        title: { text: 'Percentage', font: { size: axisFontSize, color: '#5c4023' } },
                        range: [0, 100],
                        gridcolor: '#e1d5c9',
                        showgrid: true,
                        zeroline: true,
                        showline: true,
                        linecolor: '#5c4023',
                        linewidth: 1
                    },
                    height: graphHeight,
                    margin: { l: marginLeft, r: 20, t: 40, b: marginBottom },
                    autosize: true,
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(242,232,220,0.8)',
                    legend: {
                        orientation: legendOrientation,
                        yanchor: "bottom",
                        y: 1.02,
                        xanchor: legendXAnchor,
                        x: legendX,
                        font: { size: legendFontSize, color: '#5c4023' },
                        bgcolor: 'rgba(0,0,0,0)',
                        bordercolor: 'rgba(0,0,0,0)',
                        borderwidth: 0
                    }
                };
                
                const commonConfig = getPlotlyConfig(
                    !isMobileDevice && !isTabletDevice,
                    isMobileDevice,
                    isTabletDevice
                );
                
                    if (shortGraphElement) {
                    const shortLayout = JSON.parse(JSON.stringify(commonLayoutBase));
                    shortLayout.title = {
                        text: "Real Time Monitor",
                        font: { size: titleFontSize, color: '#5c4023' },
                        y: 0.95
                    };
                    
                    Plotly.newPlot(shortGraphElement, JSON.parse(JSON.stringify(emptyTraces)), shortLayout, commonConfig);
                    
                    const shortSvg = shortGraphElement.querySelector('.main-svg');
                    if (shortSvg) {
                        shortSvg.style.backgroundColor = 'rgba(0,0,0,0)';
                    }
                    const shortPlotArea = shortGraphElement.querySelector('.plot-container');
                    if (shortPlotArea) {
                        shortPlotArea.style.backgroundColor = 'rgba(242,232,220,0.8)';
                    }
                }
                
                if (longGraphElement) {
                    const longLayout = JSON.parse(JSON.stringify(commonLayoutBase));
                    longLayout.title = {
                        text: "3 Hour Monitor",
                        font: { size: titleFontSize, color: '#5c4023' },
                        y: 0.95
                    };
                    
                    Plotly.newPlot(longGraphElement, JSON.parse(JSON.stringify(emptyTraces)), longLayout, commonConfig);
                    
                    const longSvg = longGraphElement.querySelector('.main-svg');
                    if (longSvg) {
                        longSvg.style.backgroundColor = 'rgba(0,0,0,0)';
                    }
                    const longPlotArea = longGraphElement.querySelector('.plot-container');
                    if (longPlotArea) {
                        longPlotArea.style.backgroundColor = 'rgba(242,232,220,0.8)';
                    }
                }
            }
            
            function updateShortGraph() {
                const shortGraphElement = document.getElementById('short-graph');
                if (!shortGraphElement) return;
                
                const traces = [
                            {
                                x: shortHistory.time,
                                y: shortHistory.cpu,
                                mode: 'lines',
                                name: 'CPU',
                        line: { color: '#1f77b4', width: 2 }
                            },
                            {
                                x: shortHistory.time,
                                y: shortHistory.ram,
                                mode: 'lines',
                                name: 'RAM',
                        line: { color: '#ff7f0e', width: 2 }
                            },
                            {
                                x: shortHistory.time,
                                y: shortHistory.net,
                                mode: 'lines',
                                name: 'Network',
                        line: { color: '#2ca02c', width: 2 }
                            },
                            {
                                x: shortHistory.time,
                                y: shortHistory.gpu0,
                                mode: 'lines',
                                name: 'GPU 0',
                        line: { color: '#d62728', width: 2 }
                            },
                            {
                                x: shortHistory.time,
                                y: shortHistory.gpu1,
                                mode: 'lines',
                                name: 'GPU 1',
                        line: { color: '#9467bd', width: 2 }
                            },
                            {
                                x: shortHistory.time,
                                y: shortHistory.gpu2,
                                mode: 'lines',
                                name: 'GPU 2',
                        line: { color: '#8c564b', width: 2 }
                            }
                        ];
                        
                const layout = {
                            title: {
                                text: "Real Time Monitor",
                                font: { size: 20, color: '#5c4023' },
                                y: 0.95
                            },
                            xaxis: {
                        title: { 
                            text: 'Time', 
                            font: { size: 16, color: '#5c4023' },
                            standoff: 0,
                            y: 0.8
                        },
                                gridcolor: '#e1d5c9',
                                showgrid: true,
                                zeroline: true,
                                showline: true,
                                linecolor: '#5c4023',
                                linewidth: 1,
                        tickformat: '%I:%M %p'
                            },
                            yaxis: {
                                title: { text: 'Percentage', font: { size: 16, color: '#5c4023' } },
                                range: [0, 100],
                                gridcolor: '#e1d5c9',
                                showgrid: true,
                                zeroline: true,
                                showline: true,
                                linecolor: '#5c4023',
                                linewidth: 1
                            },
                    height: 270,
                    margin: { l: 45, r: 20, t: 40, b: 60 },
                            autosize: true,
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(242,232,220,0.8)',
                            legend: {
                                orientation: "h",
                                yanchor: "bottom",
                                y: 1.02,
                                xanchor: "right",
                                x: 1,
                                font: { size: 12 },
                                bgcolor: 'rgba(242,232,220,0.7)',
                                bordercolor: '#e1d5c9',
                                borderwidth: 1
                            }
                        };
                        
                Plotly.update(shortGraphElement, {
                    x: [shortHistory.time, shortHistory.time, shortHistory.time, shortHistory.time, shortHistory.time, shortHistory.time],
                    y: [shortHistory.cpu, shortHistory.ram, shortHistory.net, shortHistory.gpu0, shortHistory.gpu1, shortHistory.gpu2]
                }, layout);
                
                const shortSvg = shortGraphElement.querySelector('.main-svg');
                if (shortSvg) {
                    shortSvg.style.backgroundColor = 'rgba(0,0,0,0)';
                }
                const shortPlotArea = shortGraphElement.querySelector('.plotbg');
                if (shortPlotArea) {
                    shortPlotArea.style.fill = 'rgba(242,232,220,0.8)';
                }
            }
            
            function updateLongGraph() {
                    const longGraphElement = document.getElementById('long-graph');
                if (!longGraphElement) return;
                
                const traces = [
                            {
                                x: longHistory.time,
                                y: longHistory.cpu,
                                mode: 'lines',
                                name: 'CPU',
                        line: { color: '#1f77b4', width: 2 }
                            },
                            {
                                x: longHistory.time,
                                y: longHistory.ram,
                                mode: 'lines',
                                name: 'RAM',
                        line: { color: '#ff7f0e', width: 2 }
                            },
                            {
                                x: longHistory.time,
                                y: longHistory.net,
                                mode: 'lines',
                                name: 'Network',
                        line: { color: '#2ca02c', width: 2 }
                            },
                            {
                                x: longHistory.time,
                                y: longHistory.gpu0,
                                mode: 'lines',
                                name: 'GPU 0',
                        line: { color: '#d62728', width: 2 }
                            },
                            {
                                x: longHistory.time,
                                y: longHistory.gpu1,
                                mode: 'lines',
                                name: 'GPU 1',
                        line: { color: '#9467bd', width: 2 }
                            },
                            {
                                x: longHistory.time,
                                y: longHistory.gpu2,
                                mode: 'lines',
                                name: 'GPU 2',
                        line: { color: '#8c564b', width: 2 }
                            }
                        ];
                        
                const layout = {
                            title: {
                        text: "3 Hour Monitor",
                                font: { size: 20, color: '#5c4023' },
                                y: 0.95
                            },
                            xaxis: {
                        title: { 
                            text: 'Time', 
                            font: { size: 16, color: '#5c4023' },
                            standoff: 0,
                            y: 0.8
                        },
                                gridcolor: '#e1d5c9',
                                showgrid: true,
                                zeroline: true,
                                showline: true,
                                linecolor: '#5c4023',
                                linewidth: 1,
                        tickformat: '%I:%M %p'
                            },
                            yaxis: {
                                title: { text: 'Percentage', font: { size: 16, color: '#5c4023' } },
                                range: [0, 100],
                                gridcolor: '#e1d5c9',
                                showgrid: true,
                                zeroline: true,
                                showline: true,
                                linecolor: '#5c4023',
                                linewidth: 1
                            },
                    height: 270,
                    margin: { l: 45, r: 20, t: 40, b: 60 },
                            autosize: true,
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            plot_bgcolor: 'rgba(242,232,220,0.8)',
                            legend: {
                                orientation: "h",
                                yanchor: "bottom",
                                y: 1.02,
                                xanchor: "right",
                                x: 1,
                                font: { size: 12 },
                                bgcolor: 'rgba(242,232,220,0.7)',
                                bordercolor: '#e1d5c9',
                                borderwidth: 1
                            }
                        };
                        
                Plotly.update(longGraphElement, {
                    x: [longHistory.time, longHistory.time, longHistory.time, longHistory.time, longHistory.time, longHistory.time],
                    y: [longHistory.cpu, longHistory.ram, longHistory.net, longHistory.gpu0, longHistory.gpu1, longHistory.gpu2]
                }, layout);
                
                const longSvg = longGraphElement.querySelector('.main-svg');
                if (longSvg) {
                    longSvg.style.backgroundColor = 'rgba(0,0,0,0)';
                }
                const longPlotArea = longGraphElement.querySelector('.plotbg');
                if (longPlotArea) {
                    longPlotArea.style.fill = 'rgba(242,232,220,0.8)';
                }
            }
            
            async function updateDashboardGraphs() {
                const newData = await fetchCurrentStats();
                if (!newData) return;
                
                    const now = new Date();
                
                    shortHistory.time.push(now);
                    shortHistory.cpu.push(newData.CPU);
                    shortHistory.ram.push(newData.RAM);
                    shortHistory.net.push(newData.NET);
                    shortHistory.gpu0.push(newData.GPU0);
                    shortHistory.gpu1.push(newData.GPU1);
                    shortHistory.gpu2.push(newData.GPU2);
                    
                    if (shortHistory.time.length > 240) {
                        shortHistory.time.shift();
                        shortHistory.cpu.shift();
                        shortHistory.ram.shift();
                        shortHistory.net.shift();
                        shortHistory.gpu0.shift();
                        shortHistory.gpu1.shift();
                        shortHistory.gpu2.shift();
                    }
                    
                updateShortGraph();
                        
                        longHistory.time.push(now);
                        longHistory.cpu.push(newData.CPU);
                        longHistory.ram.push(newData.RAM);
                        longHistory.net.push(newData.NET);
                        longHistory.gpu0.push(newData.GPU0);
                        longHistory.gpu1.push(newData.GPU1);
                        longHistory.gpu2.push(newData.GPU2);
                        
                        if (longHistory.time.length > 540) {
                            longHistory.time.shift();
                            longHistory.cpu.shift();
                            longHistory.ram.shift();
                            longHistory.net.shift();
                            longHistory.gpu0.shift();
                            longHistory.gpu1.shift();
                            longHistory.gpu2.shift();
                        }
                        
                updateLongGraph();
                
                removeNsewDragElements();
            }
            
            function applyDeviceSpecificOptimizations() {
                console.log("Applying device-specific optimizations");
                
                const shortGraph = document.getElementById('short-graph');
                const longGraph = document.getElementById('long-graph');
                const dashboardContainer = document.getElementById('dashboard-graphs-container');
                
                if (isMobileDevice) {
                    if (deviceOrientation === 'portrait') {
                        if (dashboardContainer) {
                            dashboardContainer.style.gap = '5px';
                        }
                    } else {
                        if (dashboardContainer) {
                            dashboardContainer.style.gap = '5px';
                        }
                    }
                    
                    if (shortGraph) {
                        shortGraph.style.webkitOverflowScrolling = 'touch';
                    }
                    if (longGraph) {
                        longGraph.style.webkitOverflowScrolling = 'touch';
                    }
                } else if (isTabletDevice) {
                    if (dashboardContainer) {
                        dashboardContainer.style.gap = '10px';
                    }
                } else {
                    if (dashboardContainer) {
                        dashboardContainer.style.gap = '15px';
                    }
                }
            }
        </script>
    </body>
</html>
<!-- Developed by mixbits GitHub: https://github.com/mixbits -->